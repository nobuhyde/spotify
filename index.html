<script>
    // --- 【重要：ここを書き換え！】 ---
    const CLIENT_ID = 'あなたのクライアントID'; // 32桁の英数字
    const REDIRECT_URI = 'https://ユーザー名.github.io/リポジトリ名/'; // 末尾の / まで完全に一致させる
    // ------------------------------------

    let player;
    let accessToken = "";

    // URLからトークンを抽出（ログイン後に戻ってきたとき用）
    const getAccessTokenFromUrl = () => {
        const hash = window.location.hash.substring(1).split('&').reduce((initial, item) => {
            if (item) {
                var parts = item.split('=');
                initial[parts[0]] = decodeURIComponent(parts[1]);
            }
            return initial;
        }, {});
        return hash.access_token;
    };

    accessToken = getAccessTokenFromUrl();

    // ログインボタンの処理（URLを修正しました！）
    document.getElementById('loginBtn').onclick = () => {
        const scope = 'streaming user-read-email user-read-private user-modify-playback-state';
        
        // 【修正】これが正しいSpotifyのログイン先アドレスです
        const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(scope)}`;
        
        window.location.href = authUrl;
    };

    // Spotify SDKの準備ができた時の処理
    window.onSpotifyWebPlaybackSDKReady = () => {
        if (!accessToken) return;

        player = new Spotify.Player({
            name: 'My iPad Web Player',
            getOAuthToken: cb => { cb(accessToken); },
            volume: 0.5
        });

        player.addListener('ready', ({ device_id }) => {
            document.getElementById('status').innerText = '接続完了！他のデバイスからこのプレイヤーを選んでください';
            document.getElementById('loginBtn').style.display = 'none';
        });

        player.addListener('player_state_changed', state => {
            if (!state) return;
            document.getElementById('track-name').innerText = '曲名: ' + state.track_window.current_track.name;
            document.getElementById('artist-name').innerText = 'アーティスト: ' + state.track_window.current_track.artists[0].name;
        });

        player.connect();
    };

    if (accessToken) {
        document.getElementById('status').innerText = '認証成功。プレイヤーを準備中...';
    }
</script>
